name: System_Pulse_Orchestrator

on:
  push:
    branches: [ main ]
  schedule:
    - cron: '0 * * * *' # –¢–µ–ø–µ—Ä—å –ø—É–ª—å—Å –∫–∞–∂–¥—ã–π —á–∞—Å, —á—Ç–æ–±—ã –¥–∞–Ω–Ω—ã–µ –±—ã–ª–∏ —Å–≤–µ–∂–∏–º–∏
  workflow_dispatch:

jobs:
  refresh_original:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pages: write
      id-token: write

    steps:
      - name: Checkout Original
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Mass Infrastructure Scan
        run: |
          echo "üì° –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ú–∞—Å—Å—ã (microsoft/vscode)..."
          # –ü–æ–ª—É—á–∞–µ–º –¥–∞—Ç—É –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –¥–≤–∏–∂–µ–Ω–∏—è –≤ VS Code
          MASS_DATE=$(curl -s https://api.github.com/repos/microsoft/vscode/commits/main | grep '"date":' | head -n 1 | sed 's/[^0-9T:-]//g')
          echo "MASS_LAST_ACTIVITY=$MASS_DATE" >> $GITHUB_ENV
          # –°–æ–∑–¥–∞–µ–º JSON –¥–ª—è —Å–∞–π—Ç–∞
          echo "{\"last_pulse\": \"$MASS_DATE\", \"status\": \"OPERATIONAL\", \"origin\": \"msftgits-legacy\"}" > status.json

      - name: System Reset & Injection
        run: |
          git config --global user.name "msftgits"
          git config --global user.email "msftgits@microsoft.com"

          # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–≤–æ–µ–π —Å–µ–∫—Ä–µ—Ç–Ω–æ–π –±–∞–∑—ã .env
          echo "LAST_PULSE=$(date +'%Y-%m-%d %H:%M:%S')" > .env
          echo "MASS_PULSE=${{ env.MASS_LAST_ACTIVITY }}" >> .env
          echo "SYSTEM_STATUS=OPERATIONAL" >> .env

          git add .
          if git diff --staged --quiet; then
            echo "–ò–∑–º–µ–Ω–µ–Ω–∏–π –Ω–µ—Ç."
          else
            git commit -m "üåÄ System Pulse: Integrated Mass Activity [${{ env.MASS_LAST_ACTIVITY }}]"
            git push origin main
          fi

      # --- –°–µ–∫—Ü–∏—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –Ω–∞ —Ç–≤–æ–π —Å–∞–π—Ç ---
      - name: Build and Upload Pages
        uses: actions/jekyll-build-pages@v1
        with:
          source: ./
          destination: ./_site

      - name: Deploy to GitHub Pages
        uses: actions/deploy-pages@v4
